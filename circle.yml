machine:
  environment:
    IMPORT_PATH: "github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME"
    FULL_IMPORT_PATH: "`echo $GOPATH | cut -d: -f1`/src/$IMPORT_PATH"
    DATABASE_URL: "mysql://root@tcp(localhost:3306)/circle_test"
  services:
    - mysql
dependencies:
  pre:
    - go get github.com/tools/godep
  override:
    - mkdir -p $FULL_IMPORT_PATH
    - rsync -az --delete ./ $FULL_IMPORT_PATH
    - godep restore

test:
  pre:
    - go install github.com/onsi/ginkgo/ginkgo
    - go get golang.org/x/tools/cmd/cover
    - go get github.com/mattn/goveralls
  override:
    - cd $FULL_IMPORT_PATH && ginkgo -r -cover
    - cd $FULL_IMPORT_PATH && ./testcoverage.sh
